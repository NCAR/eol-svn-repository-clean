<html>
<head>
<title>How To: Process C-130 Sounding Data</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="http://dmg.eol.ucar.edu/css/howto.css">
</head>

<body>
<h1 class="title">How To: Process C-130 Upper Air Sounding Data</h1>
<h2>Table of Contents</h2>
<div id="toc">
    <ol>
        <li><a href="#purpose">Purpose</a></li>
        <li><a href="#network">Network Information</a></li>
        <li><a href="#version">Previous Versions</a>
            <ol>		   
                <li><a href="#version:ITOP">2010 (PREDICT)</a></li>
                <li><a href="#version:ITOP">2010 (ITOP)</a></li>
                <li><a href="#version:PLOWS">2009-2010 (PLOWS)</a></li>
                <li><a href="#version:TPARC">2008 (T-PARC)</a></li>
                <li><a href="#version:RICO">2004 (RICO)</a></li>
            </ol>
        </li>
        <li><a href="#directory">Directory Structure</a></li>
        <li><a href="#process">Processing the Data</a>
            <ol> 
			<li><a href="#setup">Initial Processing Setup</a></li>     		
            <li><a href="#convert">Converting the Data</a></li>
            <li><a href="#autoqc">Auto QC</a></li>
 			<li><a href="#visual_qc">Visual QC</a></li>
            <li><a href="#finalize">Finalization</a></li>   
			<li><a href="#5mb-extract">5mb Extraction</a></li>      		
            </ol>
        </li>
        <li><a href="#documents">Documentation</a></li>
    </ol>
</div>
<a href="#">Top</a><hr />

<a name="purpose"></a><h2>Purpose</h2>
<div class="block">
	<p>This document contains instructions for converting NCAR C-130 or USAF
	C-130 dropsonde sounding data from the ISF EOL format into the EOL Sounding
	Composite (ESC) format.</p>
</div>
<a href="#">Top</a><hr />

<a name="network"></a><h2>Network Information</h2>
<div class="block">
    <ul>
    <li>The ID-Type is 99.</li>
    <li>The Platforms is 386, Aircraft, USAF C-130</li>
    </ul>
</div>
<a href="#">Top</a><hr />

<a name="version"></a><h2>Previous Versions</h2>
<div class="block">

    <a name="version:PREDICT"></a><h3>PREDICT (2010)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2Faircraft_C130_NCAR%2Ftags%2FIPREDICT_2010%2F#_conversions_upper_air_aircraft_C130_NCAR_tags_PREDICT_2010_">http://svn.eol.ucar.edu/svn/dmg/upper_air/aircraft_C130_NCAR/tags/PREDICT_2010_</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/PREDICT/upper_air/USAF_dropsonde/ESC_Processing/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/PREDICT/upper_air/USAF_dropsonde/ESC_Processing/dayfiles</td></tr>
    </table>         
    
	<a name="version:ITOP"></a><h3>ITOP (2010)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2Faircraft_C130_NCAR%2Ftags%2FITOP_2010%2F#_conversions_upper_air_aircraft_C130_NCAR_tags_ITOP_2010_">http://svn.eol.ucar.edu/svn/dmg/upper_air/aircraft_C130_NCAR/tags/ITOP_2010_</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/ITOP/upper_air/USAF_C130/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/ITOP/upper_air/USAF_C130/dayfiles</td></tr>
    </table>         
    
	<a name="version:PLOWS"></a><h3>PLOWS (2009-2010)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2Faircraft_C130_NCAR%2Ftags%2FPLOWS_2009_2010%2F#_conversions_upper_air_aircraft_C130_NCAR_tags_PLOWS_2009_2010_">http://svn.eol.ucar.edu/svn/dmg/upper_air/aircraft_C130_NCAR/tags/PLOWS_2009_2010_</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/PLOWS/upper_air/C130/2009_2010/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/PLOWS/upper_air/C130/2009_2010/final</td></tr>
    </table>         

    <a name="version:TPARC"></a><h3>T-PARC (2008)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2Faircraft_C130_NCAR%2Ftags%2FTPARC_2008%2F#_conversions_upper_air_aircraft_C130_NCAR_tags_TPARC_2008_">http://svn.eol.ucar.edu/svn/dmg/upper_air/aircraft_C130_NCAR/tags/T-PARC_2008</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/T-PARC/upper_air/USAF_C130/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/T-PARC/upper_air/USAF_C130/final</td></tr>
    </table>


    <a name="version:RICO"></a><h3>RICO (2004)</h3>
    <table class="version">
    <tr><th>Software:</th><td><a href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2Faircraft_C130_NCAR%2Ftags%2FRICO_2004%2F#_conversions_upper_air_aircraft_C130_NCAR_tags_RICO_2004_">http://svn.eol.ucar.edu/svn/dmg/upper_air/aircraft_C130_NCAR/tags/RICO_2004</a></td></tr>
    <tr><th>Raw Data:</th><td>N/A</td></tr>
    <tr><th>Final Data:</th><td>N/A</td></tr>
    </table>
</div>
<a href="#">Top</a><hr />

<a name="directory"></a><h2>Directory Structure</h2>
<div class="block">
    <h3 class="directory_head">USAF_C130/</h3>
    <table class="directories">
		<tr><th>5mb/</th><td>The directory where the extracted 5mb pressure
		sounding files are stored.</td></tr>
		<tr><th>build/</th><td>The auto-generated directory for the compiled
		Java classes.</td></tr>
		<tr><th>dayfiles/</th><td>The directory where the generated day files
		are stored.  This is the data that will be put online.</td></tr>
	    <tr><th>docs/</th><td>The directory containing documentation about the
	    processing and the data.</td></tr> 
	    <tr><th>final/</th><td>The directory where the QC'ed files are placed once
	    they have been created.</td></tr> 
	    <tr><th>logs/</th><td>The directory where the error/check files from the QC
	    are placed.</td></tr>
	    <tr><th>output/</th><td>The directory where the CLASS files are put after
	    they are generated.</td></tr> 
	    <tr><th>raw_data/</th><td>The directory where the raw data is
	    stored.</td></tr>
	    <tr><th>software/</th><td>The directory where the software for the
	    conversion is stored.</td></tr>
	    <tr><th>src/</th><td>Unused directory - required to run autoqc.</td></tr>
    </table>
</div>
<a href="#">Top</a><hr />


<a name="process"></a><h2>Processing the Data</h2>
<div class="block"> 
    <a name="setup"></a><h3>Initial Processing Setup</h3>
	<ol>
    <li><p>Copy the raw data into the <span
	class="directoryName">raw_data</span> directory. Check the assumptions made
	in the script regarding things such as file names and locations.</p>

	</ul>
	<p><i>For PREDICT 2010</i>:</p>
	<ul>	
		<li><p>The converter code was changed to expect raw data file names to
		have a .eol extension.</p></li> 
	</ul>
    
	</li>         
    </ol>  

    <a name="convert"></a><h3>Converting the Data</h3>
 	<p class="note">This step runs Perl code and should work on basically any
	machine. However, to run the autoQC and any other processing/data prep done
	by the build.xml (Ant) file, you must run on any machine with the proper
	Ant and Java setup, such as tikal.</p>       
	<p>Converting ISF EOL formatted dropsonde data into the ESC format consists
	of the following steps.</p>

	<ol>	
	<li><p>Change to the <span class="directoryName">software</span> directory.</p></li>
	<li><p>Edit the <span class="softwareName">EOL_Dropsonde_Converter.pl</span> script.</p>
	<ul>
		<li><p>Search the code for "HARD-CODED" and change the project related
		variables.</p></li>  
		<li><p><span class="beware">BEWARE:  The order of the raw data is
		important.</span>  The dropsonde data must be ordered from lowest to
		highest altitude so that when it is compiled with other sounding data,
		it will all be in the same order.  The script is currently set up to
		process data that is ordered from highest to lowest altitude (as the
		sonde was dropped from the airplane).  The script reads and processes
		the header lines and then reads the data lines into the @data array.
		The array is reversed when the converted output files are written.  If
		the raw data has already been reversed, this code will need to be
		modified.</p> 
 


		<p><i>For PREDICT 2010:</i></p>
	    <ul>
		<li><p>The raw data was ordered from highest to lowest altitude and
		needed to be printed in the reverse order.</p></li>
		<li><p>Several aircraft were used and Scot L. provided a mapping of
		the Mission ID to the Aircraft used.  This information was hard-coded into the converter.
		<pre>
		Mission ID - Aircraft
		---------------------
		0607A - AF309
		0807A - AF308
		0907A - AF302
		1007A - AF306
		1607A - AF308
		1707A - AF303

		0208A - AF309
		0308A - AF302
		0408A - AF302
		0508A - AF306

		01GGA - AF302
		0216A - AF308
		0316A - AF302

		Note that 0408A shows up in the header as 0804A. 

		</pre>
	    </ul>
	    </li>
	    <li><p>Verify that the raw data columns match the required ESC
format (<a href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/tutorial/sounding-processing-and-composite-generation/appendix-esc-format-description">see
example</a>).</p>

	    <p><i>For T-PARC 2008:</i></p>
	    <ul>
		<li><p>Some columns of the raw data may had to be disregarded.  For
		example, there were two altitude columns:  GeoPoAlt and GPSAlt.  The
		science staff indicated that GeoPoAlt was the correct column to use for
		altitude data.</li> 
	    </ul>
	    </li>
		
	</ul>
	</li>
	<li><p>Run the <span class="softwareName">EOL_Dropsonde_Converter.pl</span> script.
	This will convert the EOL data to the ESC format.</p></li> 
	<li><p>Run the format checker using the ant command:</p>
    <p class="code">ant check-format-ESC</p>
	<p>Check the log file in the <span class="directoryName">output</span>
	directory to determine if any format issues need to be addressed before
	proceeding with AutoQC.</p></li>
	</ol>


<a name="autoqc"></a><h3>Auto QC</h3>
	<p class="note">This step works best on merlot, but can be done on any
	machine with the proper Ant and Java setup.</p> 
	<p>These steps execute the automatic QC on the processed files in the <span
	class="directoryName">output</span> directory, generate log files in the
	<span class="directoryName">logs</span> directory, and place the QC'ed data
	files into the <span class="directoryName">final</span> directory, as
	specified by the <span class="softwareName">build.xml</span> file.  After
	the QC processing has completed, the <span class="softwareName">ant
	autoqc</span> command runs the format checker on the QC'ed files. Here are
	the steps to run the sounding Automatic Quality Control Processing:</p>
    <ol>
	   <li><p>Stay in/Change to the top level processing directory where the Ant
	   <span class="softwareName">build.xml</span> file is located.</p></li>
	   <li><p>Check the <span class="softwareName">build.xml</span> file for the
	   <code>autoqc</code> target for the following:</p>
           <ul>
			   <li><p>A command to copy the properties file to the build
			   directory. There is typically a copy of the autoqc properties
			   file (e.g., "us_plains_dropsonde_autoqc.properties") in the software
			   directory.</p> 
 			   <i>For T-PARC 2008:</i>
			   <ol>
 			   <li><p>It was discovered that the "us_plains_autoqc.properties"
			   file did not have the correct values for dropsondes, so a new
			   file was created to correctly perform the AutoQC.  <span
			   class="beware">BEWARE:</span> For dropsondes,  the properties
			   file to be used is
			   us_plains_dropsonde_autoqc.properties.</p></li> 			   
			   </ol>
			   </li>   		   
			   <li><p>The java command(s) will be executed on the expected data in
			   the expected locations (i.e., ensure that the directory names in
			   the build.xml file are correct and what you want.)</p></li>
			   <li><p>You have updated the project name in the build.xml,
			   if included in the build.xml file.</p></li>
		   </ul>	
		   <li><p>Perform the auto QC by executing the ant command:</p>
           <p class="code">ant autoqc</p>
		   </li>  
		   <li><p>After all issues have been resolved, notify the Scientific
		   Staff (Scot) that the data is ready for Visual QC. Also inform him
		   of any issues noted so that he will be aware of them.</p></li>
    </ol>


<a name="visual_qc"></a><h3>Visual QC</h3>
	<p>Once the auto QC is completed, email the scientific staff (i.e., Scot
	Loehrer) so that they can perform a visual QC on the data and give final
	approval of the processed data set, as required. Note that the visual qc is
	not performed on all sounding datasets.</p>


<a name="finalize"></a><h3>Finalization</h3>
	<p>After the visual QC is completed, the data set is ready to be finalized
	(i.e, prep'd for CODIAC).  
        <ol>
			<li><p> Update this "How To" document to indicate the latest
			project this conversion was executed for and include any notes
			about upgrades made specifically for that project, as required. A
			copy of this document is generally found in the <span
			class="directoryName">/docs</span> directory. Place a copy of the
			updated doc in <span
			class="directoryName">/net/web/dmg/html/software/conversions/upper_air/C130
			</span> directory. The s/w repository page points to this doc in
			that web location, so this must be updated.  The s/w repository
			page is located <a
			href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/encyclopedia/repository-dmg-subversion-listing"
			target='_top'><b>here</b></a>. </p></li>

			<li><p>Update the dataset description (or EMDAC) document for this
			conversion. Work with the scientific staff to create an EMDAC
			document. Generally, start with an existing "similar" document and
			simply update it for this project and dataset.  Generally, a copy
			of the EMDAC doc can be found in the <span
			class="directoryName">/docs</span> area.</p></li>

			<li><p>The next processing step is to create day files that
			can/will be loaded into the EMDAC/CODIAC database, along with the
			EMDAC dataset description document.  The dayfiles creation step
			will generate day files sorted by nominal release date followed by
			station location as required by CODIAC. It's very important that
			the output dayfiles be in this expected sort order so that CODIAC
			can access all the soundings within a single dayfile. Do the
			following steps to create the day files.</p>
            <ul>
				<li><p>Ensure that you are in the same (top) directory as the
				build.xml file. Create the day files using the ant command:</p>
				<p class="code">ant dayfiles</p></li>
		    </ul>
			<p>This will create a file for each day where at least one sounding
			exists in the <span class="directoryName">dayfiles</span> directory
			or whichever directory is specified as the output directory in the
			build.xml file. If this dataset is to be put online "as is", these
			ar the dayfiles to load into CODIAC.</p></li>
        </ol>


<a name="5mb-extract"></a><h3>5mb Extraction</h3>
	<p>If the converted soundings are also going to be placed into a 5mb
	composite, the soundings need to have the proper 5mb pressure level
	soundings generated.  This is done through the following steps:</p>
    <ol>
        <li><p>Generate the 5mb pressure level data files using the ant command:</p>
            <p class="code">ant 5mb-extract</p>
			<p>This will generate a 5 mb sounding file for each sounding in the
			<span class="directoryName">final</span> directory and place
			it in the <span class="directoryName">5mb</span>.  It will also run
			some final checks to make sure the format is correct. Beware that
			the file directories listed in the build.xml file are what you
			expect and want.</p>   	        
        </li>
    </ol>
	<p>The generated 5mb data files will then be available when the composite
	is generated.</p>
</div>
<a href="#">Top</a><hr>


<a name="documents"></a><h2>Documentation</h2>
<p>The following are a list of documents that may help with the conversion or
are related to the raw data.</p>
<ul>
	<li><a href="/software/tools/upper_air/autoqc">How To: AUTO QC Sounding Data</a>:  The instructions for dealing with the AUTO QC program.</li>
	<li><a href="/software/tools/upper_air/esc_format_checker">How To: ESC Format Checker</a>:  The instructions and API for working with the ESC format checker program.</li>
    <li><a href="#">How To: Process C-130 Sounding Data</a>:  This document.</li>

</ul>
<a href="#">Top</a><hr> 
<hr>

<p class="foot">Revision History:</p>
<table class="revhistory">

	<tr>
	    <td>4 May 2012</th>
		<td>Updated for PREDICT 2010<br />USAF C-130</td>
		<td>Linda Echo-Hawk</td>
	</tr>
	<tr>
	    <td>10 June 2011</th>
		<td>Updated for ITOP_2010<br />USAF C-130</td>
		<td>Linda Echo-Hawk</td>
	</tr>
	<tr>
	    <td>15 July 2010</th>
		<td>Updated for PLOWS_2009-2010<br />NCAR C-130</td>
		<td>Linda Echo-Hawk</td>
	</tr>
    <tr>
	    <td>15 September 2009</th>
		<td>Updated for T-PARC 2008<br />USAF C-130</td>
		<td>Linda Echo-Hawk</td>
	</tr> 
</table>  


</body>
</html>
