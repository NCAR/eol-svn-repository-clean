<html>
<head>
<title>How To: Process ARM SGP C1 Lamont, OK Upper Air Sounding Data</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="http://dmg.eol.ucar.edu/css/howto.css">
</head>

<body>
<h1 class="title">How To: Process ARM SGP C1 Lamont, OK Upper Air Sounding Data</h1>
<h2>Table of Contents</h2>
<div id="toc">
    <ol>
        <li><a href="#purpose">Purpose</a></li>
        <li><a href="#network">Network Information</a></li>
        <li><a href="#version">Previous Versions</a>
            <ol>
                <li><a href="#version:DC3_SGP_C1">2011 (DC3 SGP C1)</a></li>
                <li><a href="#version:DYNAMO_2011_NAURU">2011 (DYNAMO Nauru)</a></li>
                <li><a href="#version:DYNAMO_2011_MANUS">2011 (DYNAMO Manus)</a></li>
                <li><a href="#version:DYNAMO_2011_GAN">2011 (DYNAMO Gan)</a></li>
                <li><a href="#version:VORTEX2_2010">2010 (VORTEX2)</a></li>
                <li><a href="#version:VORTEX2_2009">2009 (VORTEX2)</a> - first created.</li>
            </ol>
        </li>
        <li><a href="#directory">Directory Structure</a></li>
        <li><a href="#process">Processing the Data</a>
            <ol> 
			<li><a href="#setup">Initial Processing Setup</a></li>     		
            <li><a href="#convert">Converting the Data</a></li>
            <li><a href="#autoqc">Auto QC</a></li>
 			<li><a href="#visual_qc">Visual QC</a></li>
            <li><a href="#finalize">Finalization</a></li>   
			<li><a href="#5mb-extract">5mb Extraction</a></li>      		
            </ol>
        </li>
        <li><a href="#documents">Documentation</a></li>
    </ol>
</div>
<a href="#">Top</a><hr />

<a name="purpose"></a><h2>Purpose</h2>
<div class="block">
	<p>This document contains instructions for converting high vertical resolution (2-sec) radiosonde data from NetCDF Format to the EOL Sounding Composite (ESC) Format.  The soundings were from the  Atmospheric Radiation Measurement (ARM) Southern Great Plains (SGP) Central Facility (C1) near Lamont, Oklahoma during the DC3 field campaign for 2012.  There are typically four soundings per day at 00, 06, 12 and 18 UTC.</p> 
</div>
<a href="#">Top</a><hr />

<a name="network"></a><h2>Network Information</h2>
<div class="block">
    <ul>
    <li>The ID-Type is 99.</li>
    <li>The Platform is 410, ARM AMF Sonde.</li>
    </ul>
</div>
<a href="#">Top</a><hr />

<a name="version"></a><h2>Previous Versions</h2>
<div class="block">

    <a name="version:DC3_SGP_C1"></a><h3>DC3 SGP C1 (2011)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FARM%2Ftags%2FDC3%2F#_conversions_upper_air_ARM_tags_DC3_">http://svn.eol.ucar.edu/svn/dmg/upper_air/ARM/tags/DC3</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/dc3/data_processing/upper_air/ARM_SONDE/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/dc3/data_processing/upper_air/ARM_SONDE/dayfiles</td></tr>
    </table>
    
	<a name="version:DYNAMO_2011_NAURU"></a><h3>DYNAMO Nauru (2011)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FARM%2Ftags%2FDYNAMO_2011_NAURU%2F#_conversions_upper_air_ARM_tags_DYNAMO_2011_NAURU_">http://svn.eol.ucar.edu/svn/dmg/upper_air/ARM/tags/DYNAMO_2011_Nauru</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/dynamo/upper_air/ARM_Nauru/2011-12_processing/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/dynamo/upper_air/ARM_Nauru/2011-12_processing/dayfiles</td></tr>
    </table>
    
	<a name="version:DYNAMO_2011_MANUS"></a><h3>DYNAMO Manus (2011)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FARM%2Ftags%2FDYNAMO_2011_MANUS%2F#_conversions_upper_air_ARM_tags_DYNAMO_2011_MANUS_">http://svn.eol.ucar.edu/svn/dmg/upper_air/ARM/tags/DYNAMO_2011_Manus</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/dynamo/upper_air/ARM_Manus/2011_processing/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/dynamo/upper_air/ARM_Manus/2011_processing/dayfiles</td></tr>
    </table>

    <a name="version:DYNAMO_2011_GAN"></a><h3>DYNAMO Gan (2011)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FARM%2Ftags%2FDYNAMO_2011_GAN%2F#_conversions_upper_air_ARM_tags_DYNAMO_2011_GAN_">http://svn.eol.ucar.edu/svn/dmg/upper_air/ARM/tags/DYNAMO_2011_GAN</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/dynamo/upper_air/ARM_Gan/2011_processing/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/dynamo/upper_air/ARM_Gan/2011_processing/dayfiles</td></tr>
    </table>
    
	<a name="version:VORTEX2_2010"></a><h3>VORTEX2 (2010)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FARM%2Ftags%2FVORTEX2_2009%2F#_conversions_upper_air_ARM_tags_VORTEX2_2010_">http://svn.eol.ucar.edu/svn/dmg/upper_air/ARM/tags/VORTEX2_2010</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/VORTEX2/upper_air/ARM/2010/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/VORTEX2/upper_air/ARM/2010/dayfiles</td></tr>
    </table>

    <a name="version:VORTEX2_2009"></a><h3>VORTEX2 (2009)</h3>
    <table class="version">
	<tr><th>Software:</th><td><a
	href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FARM%2Ftags%2FVORTEX2_2009%2F#_conversions_upper_air_ARM_tags_VORTEX2_2009_">http://svn.eol.ucar.edu/svn/dmg/upper_air/ARM/tags/VORTEX2_2009</a></td></tr>
    <tr><th>Raw Data:</th><td>/net/work/Projects/VORTEX2/upper_air/ARM/raw_data</td></tr>
    <tr><th>Final Data:</th><td>/net/work/Projects/VORTEX2/upper_air/ARM/dayfiles</td></tr>
    </table>

</div>
<a href="#">Top</a><hr />

<a name="directory"></a><h2>Directory Structure</h2>
<div class="block">
    <h3 class="directory_head">ARM_SGP C1/</h3>
    <table class="directories">
		<tr><th>5mb/</th><td>The auto-generated directory where the extracted
		5mb pressure sounding files are stored.</td></tr>
		<tr><th>build/</th><td>The auto-generated directory for the compiled
		Java classes.</td></tr>
		<tr><th>dayfiles/</th><td>The auto-generated directory where the
		generated day files are stored.  These are the final processed data
		files that will be loaded into the database and put online.</td></tr>
	    <tr><th>docs/</th><td>The directory containing documentation about the
	    processing and the data.</td></tr> 
	    <tr><th>final/</th><td>The directory where the QC'ed files are placed once
	    they have been created.</td></tr> 
		<tr><th>logs/</th><td>The auto-generated directory where the
		error/check files from the QC are placed.</td></tr>
		<tr><th>output/</th><td>The directory where the converter places the
		ESC files after they are generated.</td></tr> 
	    <tr><th>raw_data/</th><td>The directory where the raw data is
	    stored.</td></tr>
		<tr><th>software/</th><td>The directory where the software for the
		conversion is stored. The autoqc properties file also goes in this
		directory.</td></tr>
	    <tr><th>src/</th><td>Unused directory - required for autoqc to run.</td></tr>
    </table>
</div>
<a href="#">Top</a><hr />


<a name="process"></a><h2>Processing the Data</h2>
<div class="block"> 
    <a name="setup"></a><h3>Initial Processing Setup</h3>
	<ol>
	<li><p>Copy the raw data into the <span
	class="directoryName">raw_data</span> directory. Check the assumptions made
	in the script regarding things such as file names and locations.</p>
	</li>         
    </ol>  

    <a name="convert"></a><h3>Converting the Data</h3>
 	<p class="note">This step runs Perl code and should work on basically any
	machine. However, to run the autoQC and any other processing/data prep done
	by the build.xml (Ant) file, you must run on any machine with the proper
	Ant and Java setup, such as tikal.</p>       
	<p>Converting NetCDF formatted dropsonde data into the ESC format consists
	of the following steps.</p>

	<ol>	
	<li><p>Change to the <span class="directoryName">software</span> directory.</p></li>
	<li><p>Edit the <span class="softwareName">ARMnetCDF_to_ESC.pl</span> script.</p>
	<ul>
		<li><p>Search for "HARD-CODED" to find and change the hard-coded
		project-specific values in the script to be correct for your project.
		For example, change the function: <code>getProjectName</code> to the
		current project.</p></li>
		<li><p>Run the <span class="softwareName">ncdump</span> tool on a small
		test group of raw data files to examine the variables specific to your
		data.  This will help you confirm whether or not the varaibles
		hard-coded into the <code>getFields</code> and
		<code>get_global_atts</code> subroutines are appropriate or need to be
		changed.</p></li>
	</ul>
	</li>
	<li><p>Run the <span class="softwareName">ARMnetCDF_to_ESC.pl</span> script.
	This will convert the NetCDF data to the ESC format.
	<ul>
		<li>For DYNAMO 2011 a new command line option was added so that users
		could select either 6-hourly (4 per day) or 3-hourly (8 per day)
		sounding collection frequency.  This choice will determine which code
		is used to determine the nominal time.  The choices are either "4" or
		"8" and if no choice is selected, then the default value of "4" will be
		used.  Use the switch like this:<br /> <p
		class="code">ARMnetCDF_to_ESC.pl --limit --num_soundings=8 &gt;
		logfile</p> </li>
	</ul>
	
	<i>For DC3</i>:
	<ul>
	    <li><p>No major changes were needed for the converter, but the format checker tool uncovered a problem with one file that had a line length &gt; 130 characters due to the dewpoint value being -100.0.  Code was in place to check for dewpoints &lt; 99.9999, but this was missed.  It turned out that the value causing problems was -99.73 which rounded up to -100.0.  Because of the rounding, I changed to code to check for values &lt;= -99.98.  While this fixed this issue, it is possible that future conversions may have a similar issue with a value that rounds and this should be watched for.</p></li>
		<li>The science staff notified us that two files had header lat/lon of 0.000/0.000 and also needed a correction factor for longitude (-97.490) and latitude (36.610).  The <span class="softwareName">Adjust_DC3_ARM_LatLon.pl</span> script was created and the script was run on the two problem files.</li>
   	</ul>
	</li> 

	<li><p>Run the format checker using the ant command:</p>
    <p class="code">ant check-format-ESC</p></li>
	<li><p>Check the log file (generated by the format checker) in the <span
	class="directoryName">output</span> directory to determine if any format
	issues need to be addressed before proceeding with AutoQC.</p></li>
	</ol>

<a name="autoqc"></a><h3>Auto QC</h3>
	<p class="note">This step works best on tikal, but can be done on any
	machine with the proper Ant and Java setup.</p>

	<p>These steps execute the automatic QC on the processed files in the <span
	class="directoryName">output</span> directory, generate log files in the
	<span class="directoryName">logs</span> directory, and place the QC'ed data
	files into the <span class="directoryName">final</span> directory, as
	specified by the <span class="softwareName">build.xml</span> file.  The
	final part of the automated process is to run the format checker on
	the QC'ed files.  To run the sounding Automatic Quality Control
	Processing:</p>
    <ol>
	   <li><p>Stay in/Change to the top level processing directory where the Ant
	   <span class="softwareName">build.xml</span> file is located.</p></li>
	   <li><p>Check the <span class="softwareName">build.xml</span> file for the
	   <code>autoqc</code> target for the following:</p>
           <ol>
			   <li><p>A command to copy the properties file to the build
			   directory. There is typically a copy of the autoqc properties
			   file (e.g., "us_plains_autoqc.properties") in the
			   software directory.</p></li>   		   
			   <li><p>The java command(s) will be executed on the expected data
			   in the expected locations (i.e., ensure that the directory names
			   in the build.xml file are correct and what you want.)</p></li>
			   <li><p>You have updated the project name in the build.xml,
			   if included in the build.xml file.</p></li>
		   </ol>
	   <li><p>Perform the auto QC by executing the ant command:</p> <p
	   class="code">ant autoqc</p></li>  
	   <li><p>After all issues have been resolved, notify the Scientific Staff
	   (Scot) that the data is ready for Visual QC. Also inform him of any
	   issues noted so that he will be aware of them.</p></li>
    </ol>


<a name="visual_qc"></a><h3>Visual QC</h3>
	<p>Once the auto QC is completed, email the scientific staff (i.e., Scot
	Loehrer) so that they can perform a visual QC on the data and give final
	approval of the processed data set, as required. Note that the visual qc is
	not performed on all sounding datasets.</p>



<a name="finalize"></a><h3>Finalization</h3>
	<p>After the visual QC is completed, the data set is ready to be finalized
	(i.e, prep'd for CODIAC).  
       <ol>
		 <li><p> Update this "How To" document to indicate the latest project
		 this conversion was executed for and include any notes about upgrades
		 made specifically for that project, as required. A copy of this
		 document is generally found in the <span
		 class="directoryName">/docs</span> directory. Place a copy of the
		 updated doc in <span
		 class="directoryName">/net/web/dmg/html/software/conversions/upper_air/ARM_CART
		 </span> directory. The s/w repository page points to this doc in that
		 web location, so this must be updated.  The s/w repository page is
		 located <a
		 href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/encyclopedia/repository-dmg-subversion-listing"
		 target='_top'><b>here</b></a>. </p>

		 <li><p>Update the dataset description (or EMDAC) document for this
		 conversion. Work with the scientific staff to create an EMDAC
		 document. Generally, start with an existing "similar" document and
		 simply update it for this project and dataset.  Generally, a copy of
		 the EMDAC doc can be found in the <span
		 class="directoryName">/docs</span> area.</p>

		<li><p>The next processing step is to create day files that can/will be
		loaded into the EMDAC/CODIAC database, along with the EMDAC dataset
		description document.  The dayfiles creation step will generate day
		files sorted by nominal release date followed by station location as
		required by CODIAC. It's very important that the output dayfiles be in
		this expected sort order so that CODIAC can access all the soundings
		within a single dayfile. Do the following steps to create the day
		files.</p>
    <ol>
	   <li><p>Ensure that you are in the same (top) directory as the build.xml
	   file. Create the day files using the ant command:</p>
	   <p class="code">ant dayfiles</p> <p>This will create a file for each day
	   where at least one sounding exists in the <span
	   class="directoryName">dayfiles</span> directory or whichever directory
	   is specified as the output directory in the build.xml file. If this
	   dataset is to be put online "as is", these ar the dayfiles to load into
	   CODIAC.</p>
       </li>
    </ol>
    </ol>


<a name="5mb-extract"></a><h3>5mb Extraction</h3>
	<p>If the converted soundings are also going to be placed into a 5mb
	composite, the soundings need to have the proper 5mb pressure level
	soundings generated.  This is done through the following steps:</p>
    <ol>
        <li><p>Generate the 5mb pressure level data files using the ant command:</p>
            <p class="code">ant 5mb-extract</p>
			<p>This will generate a 5 mb sounding file for each sounding in the
			<span class="directoryName">final</span> directory and place
			it in the <span class="directoryName">5mb</span>.  It will also run
			some final checks to make sure the format is correct. Beware that
			the file directories listed in the build.xml file are what you
			expect and want.</p>   	        
        </li>
    </ol>
	<p>The generated 5mb data files will then be available when the composite
	is generated.</p>

</div>
<a href="#">Top</a><hr>

<a name="documents"></a><h2>Documentation</h2>
<p>The following are a list of documents that may help with the conversion or
are related to the raw data.</p>
<ul>
	<li><a href="/software/tools/upper_air/autoqc">How To: AUTO QC Sounding Data</a>:  The instructions for dealing with the AUTO QC program.</li>
	<li><a href="/software/tools/upper_air/esc_format_checker">How To: ESC Format Checker</a>:  The instructions and API for working with the ESC format checker program.</li>
    <li><a href="#">How To: Process ARM SGP C1 Sounding Data</a>:  This document.</li>

<!-- documentation no longer found

    <li><a href="howto_insert_text_class_soundings.html">How To: Insert Text CLASS Sounding Data into the Database</a>: The instructions on how insert the ESC sounding data into the database.</li>
    <li><a href="./readme_t-parc_gts_sounding.html">readme_tparc_nrl_p3_soundings.html</a>: The database readme file for T-PARC.</li>
    <li><a href="./fsl_format-new.cgi">fsl_format-new.cgi</a>: The raw data readme for the T-PARC data.</li>

-->
</ul>
<a href="#">Top</a><hr>

<p class="foot">Last Updated: 10 December 2012 - Linda Echo-Hawk</p>
</body>
</html>
