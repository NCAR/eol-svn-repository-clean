<html>
<head>
<title>How To: Process Indonesian Padang Sounding Data</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="http://dmg.eol.ucar.edu/css/howto.css">
</head>

<!-- Put copy of this file into  /net/web/dmg/html/software/conversions/upper_air/Padang -->

<body>
<h1 class="title">How To: Process Indonesian Padang Sounding Data</h1>
<a name="toc"></a><h2>Table of Contents</h2>
<div id="toc">
    <ol>
        <li><a href="#purpose">Purpose</a></li>
	<li><a href="#network">Network Information</a></li>
	<li>Previous Versions<ol>
                <li><a href="#version:dynamo2011">2011-2012 (DYNAMO)</a></li>
		</ol></li>
	<li><a href="directory">Directory Structure</a></li>
	<li>Processing the Data<ol>
	        <li><a href="#proc_setup">Initial Processing Setup</a></li>
                <li><a href="#convert_Indo_Padang">Converting the Data</a></li>
		<li><a href="#autoqc">Auto QC</a></li>
                <li><a href="#visual_qc">Visual QC</a></li>
                <li><a href="#finalize">Finalization</a></li>
	        </ol></li>
	<li><a href="#documents">Documentation</a></li>
    </ol>
</div>
<a href="#">Top</a><hr />

<a name="purpose"></a><h2>Purpose</h2>
<div class="block">
    <p>This document contains the process of how to convert the Padang, Indonesia sounding data.  </p>

</div>
<a href="#">Top</a><hr />

<a name="network"></a><h2>Network Information</h2>
<div class="block">
    <ul>
	<li>The Platform is 439.</li>
        <li>The soundings are recorded in Local Time and must be post processed into UTC time.
            The local time is -7.0 hours and 0 minutes off from UTC.
        </li>
    </ul>
</div>
<a href="#">Top</a><hr />

<a name="version"></a><h2>Previous Versions - <font size=-1>Note that the project conversions were done in the order shown below. Do not go by the year of the project to find the latest converted data or software. The latest s/w will always be in the trunk of the repository.</font></h2>
<div class="block">

    <a name="version:dynamo2011"></a><h3>DYNAMO (2011-2012)</h3>
    <table class="version">
        <tr><th>Software:</th><td><a href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FIndonesia_Padang_Meisei%2Ftags%2FDYNAMO_2011-12%2F#_conversions_upper_air_Indonesia_Padang_Meisei_tags_DYNAMO_2011-12_">http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FIndonesia_Padang_Meisei%2Ftags%2FDYNAMO_2011-12%2F#_conversions_upper_air_Indonesia_Padang_Meisei_tags_DYNAMO_2011-12_</a>
        <tr><th>Raw Data:</th><td>/net/work/Projects/dynamo/upper_air/Indonesia_Padang/raw_data/</td></tr>
        <tr><th>Final Data:</th><td>/net/archive/data/dynamo*/upper_air/Indonesia_Padang/dayfiles</td></tr>
    </table>

</div>
<a href="#">Top</a><hr />

<a name="directory"></a><h2>Directory Structure</h2>
<div class="block">
    <h3 class="directory_head">NWS/</h3>
    <table class="directories">
	<tr><th>build/</th><td>The auto-generated directory for the compiled Java classes.</td></tr>
	<tr><th>dayfiles/</th><td>The directory containing final dayfiles ready to loaded into the database.</td></tr>
	<tr><th>docs/</th><td>The directory containing documentation about the processing and the data.</td></tr>
	<tr><th>final/</th><td>The directory where the auto QC'd and visual QC'd files are placed.</td></tr>
	<tr><th>logs/</th><td>The directory where the error/check files from the QC are placed.</td></tr>
	<tr><th>output/</th><td>The directory where the processed ESC files are written to during data conversion.</td></tr>
	<tr><th>raw_data/</th><td>The directory where the raw data are stored for the conversion.</td></tr>
	<tr><th>software/</th><td>The directory where the executable software for conversion is stored.</td></tr>
	<tr><th>src/</th><td>Directory required for autoQC.</td></tr>
    </table>
</div>
<a href="#">Top</a><hr />

<h2>Processing the Data</h2>
<div class="block">

<a name="proc_setup"></a><h3>Initial Processing Setup</h3>
<div class="block">
    <p>
       <li><a href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/how-to/ant-setup-and-use">Setup Ant</a>:  
The autoQC and format checker use an Ant build configuration and must be setup in your environment.  If your environment 
has already been setup for Ant, this step may be skipped.  To setup your environment for Ant, see:  
<a href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/how-to/ant-setup-and-use">Ant Setup and Use</a>.</li>
    </p>
</div>

<a name="convert_Padang"></a><h3>Convert the Indonesian Padang Data</h3>
<div class="block">
    <p class="note">The autoQC, dayfiles, and check-format steps need to be done
         on a machine with the proper Ant and Java setup.</p>
    <ol>
        <li> <p><b>Preprocess the raw Meisei data to generate information about the times in the data.</b>

             This output info is then provided to the scientific staff for review. Before
             executing this command, ensure that all raw Meisei data are copied into the
             /raw_data directory. Also ask the scientific staff whether or not this step
             is required. They may or may not need to analyze the data before doing the
             data conversion. Note that this step will generate an output file named
             "[input_file_name].TimesFixed". These *.TimesFixed files are not used to
             produce the final converted data. These are for scientific staff review only.</p>

            <p>Execute the following command:</p>
            <p class="code">preproc_raw_Meisei_data.pl F2012032406S7111241.CSV  >& output.log </p>
             
        <li><p><b>Convert the data from Meisei format to ESC format.</b>

            Ensure that you have copied all the raw Meisei data files into the /raw_data directory. 
            These files have a specific naming convention (e.g., F*.CSV) and the conversion
            software is looking to process all *.CSV files in the raw data directory. The command 
            below will run the converter (<span class="softwareName">Indonesia_Padang_converter.pl</span>) in the background 
            and will write all warnings and messages to a log file named padang.log. 
            The log file will be located in the same dir as where the converter is being executed.
            The converter outputs data in ESC format into the /output directory.
            <i>Note that the original raw data are in local time and the converted does not change
            the times to UTC. Times are converted from Local to UTC in the step #3.</i></p>

            <p>Execute the following command:</p>
            <p class="code">Indonesia_Padang_converter.pl  >& padang.log &</p>
            <p>ESC formatted files (in local time) will be created in the /output directory.
               The files are named *.cls.</p>
        </li> <br>

        <li><b>Convert the Local times to UTC Times.</b>

            <p>To convert the ESC file from Local time to UTC time, 
            find the <b>convertTime.sc</b> script in the software directory and
            update the code to identify the proper files to convert AND
            to properly set the offset from UTC value.  For Padang,
            the <font color=red>offset from UTC is "-7" hours and "0 minutes</font>. Depending on how you identify
            the files to work on, you may need to run this script in the
            directory where the ESC output files are located (i.e., /output). Beware that
            the script convertTime.sc contains a For loop that repeatedly
            calls the <span class="softwareName">convertESCLocalToUTC.pl</span> PERL script which actually
            converts the times to UTC. If you want to convert the local time
            to UTC for a single file see the second command below. </p>

            <p>To update the times in all /output ESC files, execute:</p>
            <p class="code">convertTime.sc</p>

            <p>To update the times in just one file (e.g., Padang_201111021716.cls), execute:</p>
            <p class="code">convertESCLocalToUTC.pl Indonesia_Padang_201203301130.cls -7 0</p>

            <p>When the user completes this step, the user should ensure that 
               all data times have been converted to UTC time. 
               The script that converts time to UTC creates  output files that
               are named "[input_file].utc". These are the files to format check and autoQC.</p>
    </ol>
</div>

<a name="checkformat"></a><h3>Check ESC Format</h3>
<div class="block">
    <p class="note">This step works is repeated by the ant command to run autoQC but on the autoQC'd data file. </p>

    <p>This step executes the check format ESC code and generates a log file in the /output dir.  Stay in/Change to the top level processin directory where the Ant <span class="softwareName">build.xml</span> file is located.</p>
     <p>Perform the check format command by executing the ant command: <p class="code">ant check-format-ESC</p>
</div>


<a name="autoqc"></a><h3>Auto QC</h3>
<div class="block">
    <p class="note">This step works on any machine with the proper Ant and Java setup.</p>
    <p>This step executes the automatic QC on the processed files (/output), generates log files (/logs), 
and places the QC'ed files in the final directory specified by the build.xml file (/final).  
After autoQC runs, the build.xml file will run the format checker on the QC'ed files. 
<p class="note">BEWARE: that the build.xml script runs a specific version of the autoQC s/w. </p>
    <ol>
       <li>Stay in/Change to the top level processin directory where the Ant <span class="softwareName">build.xml</span> file is located.</li>
       <li>Check the <span class="softwareName">build.xml</span> file for the <code>autoqc</code> target and make sure there are:
           <ol>
               <li>Command to copy the property files to the build directory. 
               <p class="note">Beware that there are different versions of the properties files required to
                   run autoQC. There are "HOT" and "COLD" properties files and 
                   there are upsonde, dropsonde, and driftsonde properties files. 

                   For the now, we use the us_plains_autoqc.properties files (typically located in the /software dir). 
                   The us_plains_autoqc.properties files is used for "HOT" upsondes.   </p>
               </li> 
               <li>See the build.xml file to determine the exact location and form of the input data QC'd and the output data generated. 
                   Ensure that these are correct.</li>
           </ol></li>
       <li><p>Perform the auto QC by executing the ant command:</p>
           <p class="code">ant autoqc</p>
       </li>

       <li> <p> This stations Lat is within 1 degree of the equator and the autoqc software
                incorrectly changes the very small, negative latitude to be positive. So you
                must run a script to add back in the negative sign to the Latitude.  Run this
                script on the output files in the /final directory and then rename that corrected
                output to have only the *.cls suffix. Run the script <span class="softwareName">WritePadangLatLonHdr.sc</span> which calls <span class="softwareName">WritePadangLatLonHdr.pl</span> for each of
                the files in the directory. The corrected output file names will have *.corrLoc as
                the suffix. Rename *.cls.corrLoc to *.cls. <font color=red>BEWARE: That both the
                autoQC and the dayfiles creator will reset these small negative numbers to positive
                numbers so until these are fixed, you MUST do this after both the autoQC and the
                dayfiles creator.</font>
       </li>
    </ol>
</div>

<a name="visual_qc"></a><h3>Visual QC</h3>
<div class="block">
    <p>Once the auto QC is completed, the scientific staff (generally Scot Loehrer) will perform a visual QC on the data and do final
       approval of the processed data set.  <br> <br> Scot uses a piece of s/w  (XQC) that will only execute on a Solaris OS 
       like Cabernet (or Pandora). </p>
    <p> Visual QC generates *.cls.qc files generally in <span class="directoryName">/final</span> for the data.
</div>

<a name="finalize"></a><h3>Create Dayfiles and Finalize the Dataset</h3>
<div class="block">
    <p>After the visual QC is complete, the data set is ready to be prepared for database entry. You must create day files that 
       can be loaded into the archive database.</p>

    <h5>For General Projects</h5>
    <p>The following ant dayfiles command will generate day files sorted 
       by nominal release date and then by station location as required by CODIAC.</p>
    <ol>
       <li><p>Create the day files using the ant command:</p>
           <p class="code">ant dayfiles</p>
           <p>This creates an output *.cls file in the <span class="directoryName">database</span> directory 
              for each day where there exists at least one sounding in the <span class="directoryName">final</span> 
              directory or whichever input directory is specified in the build.xml file.</p>
           </li>

       <li> <p> This stations Lat is within 1 degree of the equator and the autoqc software
                incorrectly changes the very small, negative latitude to be positive. So you
                must run a script to add back in the negative sign to the Latitude.  Run this
                script on the output files in the /final directory and then rename that corrected
                output to have only the *.cls suffix. Run the script <span class="softwareName">WritePadangLatLonHdr.sc</span> which calls <span class="softwareName">WritePadangLatLonHdr.pl</span> for each of
                the files in the directory. The corrected output file names will have *.corrLoc as
                the suffix. Rename *.cls.corrLoc to *.cls. <font color=red>BEWARE: That both the
                autoQC and the dayfiles creator will reset these small negative numbers to positive
                numbers so until these are fixed, you MUST do this after both the autoQC and the
                dayfiles creator.</font>
       </li>

    </ol>

</div>


<p><a href="#">Top</a></p><hr />

<a name="documents"></a><h2>Documentation</h2>
<div class="block">
    <p>The following are a list of documents that may help with the conversion or are related to the raw data.</p>
    <ul>
	<li><a href="/software/tools/upper_air/autoqc">How To: AUTO QC Sounding Data</a>- The instructions for dealing with the AUTO QC program.</li>
	<li><a href="/software/tools/upper_air/esc_format_checker">How To: ESC Format Checker</a>- The instructions and API for working with the ESC format checker program.</li>
	<li><a href="#">How To: Process Indonesian Padang Sounding Data</a>- This document.</li>
        <li><a href="/software/library/java/station">Java Station Library API</a></li>
        <li><a href="/software/library/java/upper_air">Java Upper Air Library API</a></li>
        <li><a href="/software/library/java/utilities">Java Utilities Library API</a></li>
    </ul>
</div>
<a href="#">Top</a><hr>

<p class="foot">Last Updated: 2 October 2012 - Linda Cully</p>
</body>
</html>

