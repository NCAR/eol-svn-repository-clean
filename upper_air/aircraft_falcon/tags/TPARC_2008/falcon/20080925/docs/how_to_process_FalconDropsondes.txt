How to Process Falcon Dropsondes  - August 2008 LEC
---------------------------------------------------

BEWARE: There's a better version of this document in PLONE under
the CDS/DMG documentation page. Search for that and update the
PLONE version for all subsequent processing.

1. Check s/w out of svn. Ensure you get the version (or later version)
updated by L.E. Cully in Jun 2008. The processing code was updated using
adapted from the RAINEX NRL_P3 s/w.

When you check out the s/w, you should also get several dirs: 
   5mb  build  build.xml  database  docs  final  logs  output  raw_data  software src 
These directories are discussed below.

3. To run the conversion from the /software directory, issue the following command:

   Falcon_Dropsonde_Converter.pl >& Falcon_Dropsonde.log &

The Falcon_Dropsonde.log file will contain a list of files processed by the converter. 
This will be the only output if there are no errors. Other output files are discussed
below, but the basic converted files will be in /output/*.cls files.

4. Check the output files.

Run (in the top directory where the build.xml file is located) the following command:
"ant check-format-ESC" .  Beware that the "ESC Format Checker" only works on 
individual sounding files that contain one sounding from one station. This
should be the case with the conversion since the raw data are generally one
station per file.

Checking the converted data files will generate the following output 
file: /output/check_format_cnvESC.log. Check this log file for errors and warnings.

5. AutoQC the output files.

To run autoqc on the sounding data, execute the following command in the top directory
where the build.xml file is located.

"ant autoqc"

Note that this will also automatically rerun the checker from step 4 above
on the newly created QC'd files located in the /final directory. See the checker log
file (/final/check_format_qc.log) generated by the rerun of the checker discussed in step 4.

Running the autoqc generates QC'd files in the /final directory. These output file 
have names of the form "D-CMET_YYYYMMDDHHMM.cls" where an example is "D-CMET_200206071742.cls".
The autoqc creates /logs/*cls.err log files, one log file per processed file. 
Check these output files for autoqc errors and warnings. 
 
6. Give notice to the scientific staff that you have completed the processing
and they can now review all log files and perform visual QC on the autoQC'd 
sounding files. Note that when the scientific staff runs the tool that
performs visual QC, it creates files with names of the form
"D-CMET_YYYYMMDDHHMM.cls.qc" where an example is "D-CMET_200206071742.cls.qc".
These *.qc files are the ones to be included in the Hi Res composite.

7. If required, you can run the 5mb extractor (see the ant file for this). It
appears that you can run the 5mb extractor on individual networks OR on the
composite according to the results of the reprocessing for IHOP 2002.

---end of processing---

Directory Discussion
--------------------

software directory
------------------
The actual conversion s/w is /software/Falcon_Dropsonde_Converter.pl . 

The log file will contain a list of files processed by the converter. This
will be the only output if there are no errors.

raw_data directory
------------------
When the software runs, it expects the input data to be located in the
/raw_data/RF directories, where RF stands for Research Flight. The s/w
will process all *.cls files in that/those dirs. The form of the input
file names is " DYYYYMMDD_HHMMSSQC.cls" where an example would be 
"D20020603_121429QC.cls".

output directory
----------------
The conversion s/w places it's output in the /output directory.
The form of the output file name is "D-CMET_YYYYMMDDHHMM.cls" where
an example would be "D-CMET_200206031706.cls".

The conversion s/w also outputs the /output/station_summary.log,
/output/warning.log files.  The station_summary.log file contains
a list of the number of networks found while processing the data,
number of stations and a note about the hemisphers seen in the
data. Since the data comes from a moving aircraft, the lat/lons
given in the stationCD.out file (see below) are missing. Since
the lat/lon for the station is given as negative (-999.99), this
(based on a very simple check in the s/w) indicates the Southern
Hemisphere and generates the rather erroneous note about the
station being in South America. This message should be ignored.

Contents of station_summary.log file:
-------------------------------------
There were 1 networks found:
        Falcon_Aircraft: 1 stations.
The following hemispheres were seen in the stations:
        south-west: S. America
---end of contents----

Also not that the /output/warning.log file will be empty if 
the s/w runs successfully and without warning.

final directory
---------------
When the conversion code runs, it places output file 
Falcon_Aircraft_"project"_sounding_stationCD.out in the /final
directory. This is the standard stationCD.out file used to
form the project's final station list. For IHOP_2002, the
file was named: Falcon_Aircraft_IHOP_2002_sounding_stationCD.out 
and contained only one record. That record looked like the following 
minus the quotes and embedded return:
"D-CMET            99  -99.99999  -999.99999   0     2 Falcon 20, D-CMET                              (N) 
20020517 20020609 US 99 ???   0.00 n  340 no set schedule   -9999.9 m"


5mb directory
---
Not used, but could be used to contain the 5mb extracted data day files
that could be included in the 5mb sounding composite.

build directory
---------------
Contains Java classes, properties file used by autoqc.

build.xml  
---------
This ant file is used to control the checking, autoqcing, etc for
this conversion. It does not control the actual conversion which
is discussed above.

database directory
------------------
Should contain final file to be loaded
into the CODIAC/EMDAC "database". These
are the files that go online to the public.

docs directory
--------------
Contains this How To doc. Use and update the newer Plone doc instead.

logs
----
Contains log file from checking and autoqc output.

input_dayfile directory 
-----------------------
Contains the auto and visual QC'd files to be included
in the final dayfiles for the composite.

src
---
Required for Java to run correctly. Some of the processing appears
to check for this dir. This should be investigated. Maybe this
dir can be removed.

software
--------
Contains the Perl program to do the actually processing and the properties
file required by the autoQC (i.e., files Falcon_Dropsonde_Converter.pl and
us_plains_autoqc.properties).

---end of doc----
