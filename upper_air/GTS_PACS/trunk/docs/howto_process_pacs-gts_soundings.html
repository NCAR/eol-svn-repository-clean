<html>
<head>
<title>How To: PACS-GTS Soundings</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="/dpg/GENERAL/dpg_howto.css">
</head>

<body>
<h1>How to Process PACS-GTS Sounding Data</h1>

<h2>Table of Contents</h2><ol>
	<li><a href="#background">Background</a></li>
	<li><a href="#process">The Process</a></li>
	<li><a href="#software">Software</a></li>
	<li><a href="#docs">Documentation</a></li>
</ol>
<hr>

<a name="background"></a>
<h2>Background</h2>
<p>This document contains the instructions on how to process the sounding data from GTS for PACS into the CLASS format, auto qc the CLASS files, create the EBUFR files, and insert them into CODIAC.</p>
<p>The following is a list of important pieces of information for the PACS GTS sounding data.</p>
<ul>
	<li><b>HOME Directory:</b> /work/PACS/SOUNDING/GTS</li>
	<li><b>CODIAC Dataset ID:</b>  15.202</li>
	<li><b>CODIAC Archive Directory:</b> /archive/codiac/pacs/soundings/GTS_class_format</li>
</ul>

<table border=1>
  <tr><th>Directories under the HOME Directory</th><th class="header">Description</th></tr>
  <tr><th>archive</th><td>This directory contains the data that has already been converted to CLASS, converted to EBUFR, and placed into CODIAC.</td></tr>
  <tr><th>autoqc</th><td>This directory contains the files needed to compile and run the auto qc on the PACS GTS sounding data.</td></tr>
  <tr><th>codiac</th><td>This directory contains the files containing the sql commands for inserting the EBUFR files into CODIAC.</td></tr>
  <tr><th>docs</th><td>This directory contains documentation for the PACS GTS sounding data.</td></tr>
  <tr><th>ebufr</th><td>This directory contains the files needed to convert the auto qc'ed data into the EBUFR format along with the created EBUFR files.</td></tr>
  <tr><th>err_logs</th><td>This directory contains the error log files generated by the auto qc.</td></tr>
  <tr><th>final</th><td>This directory contains the individual qc'ed sounding files in CLASS format.</td></tr>
  <tr><th>orig_raw_data</th><td>This directory contains the original raw data files from the source.</td></tr>
  <tr><th>output</th><td>This directory contains the individual sounding files in CLASS format that were created from the conversion from the raw data.</td></tr>
  <tr><th>raw_data</th><td>This directory contains the raw data after it has been converted from the original raw data format to the format that can be used by the conversion software.</td></tr>
  <tr><th>software</th><td>This directory contains the executables that are used to convert the data.  <font class="note">All of the EBUFR software is in the <b>ebufr</b> directory.</font></td></tr>
</table>



<hr>
<a name="process"></a>
<h2>The Process</h2>
<ol>
	<li><b>Clean the Directories the will be Used:</b>
		<p>PACS is a multi-year climatology project and JOSS receives data in chunks that need to be processed.  Only the newly collected data will need to be converted, since previous data should have been converted at the time it was received.  Therefore, the directories need to be <i>cleaned</i> to prevent the data that was previously converted from being converted again.</p>
		<p>There is a directory called <b>archive</b>.  This directory contains a number of subdirectories that match the directories in the top level <b>PACS-GTS</b> directory.  All of the files in the <b>ebufr</b>, <b>err_logs</b>, <b>final</b>, <b>output</b>, and <b>raw_data</b> need to be moved to the appropriate directory in the <b>archive</b> directory to prevent them from being either overwritten or reconverted by the software.</p>
		<p>In the software directory, there is a script called <b>archive.pl</b>.  This will move and gzip all of the files to be archived.  It is run by:</p>
		<p class="code">./archive.pl</p>
		<p class="note">This is a good step to perform at the end of the process as well.  This will empty the directories and prevent the next person from running the conversion from accidentally reconverting everything.</p>
		</li>

	<li><b>Copy the Data to the Original Raw Data Directory:</b>
		<p>Copy the <b>.txt</b> raw data files to the <b>orig_raw_data</b> directory.  This directory is to contain the raw files that were sent from the data source before any of the local processing.  These files will be converted into an ASCII format that is readable by the software.</p>
		</li>
		
	<li><b>Generate the Raw Data to be Processed:</b>
		<p>There are two types of raw data and are both ASCII formats.  The first type is what is received from the source.  The second is what the software is designed to process.  There is an executable (<b>readupa</b>) that converts the original raw data to the usuable raw data.</p><ol>
			<li>Edit the source file:
				<p>The <b>readupa.f</b> source file has the name of the file that needs to be converted to the usuable raw format hard coded in it.  This needs to be changed for the file to be converted.</p>
				</li>
			<li>Remake the Executable:
				<p>The executable <b>readupa</b> needs to be recreated with the new file name.  This is done by:</p>
				<p class="code">make readupa</p>
				</li>
			<li>Run the Executable:
				<p>Convert the original raw data file into a usable raw data file.  It is done by:</p>
				<p class="code">./readupa > ../raw_data/$filename</p>
				<p>The file name is the same name as the input file but with the <b>.out</b> extension instead of the <b>.txt</b> extension.</p>
				</li>
			</ol>
			</li>

	<li><b>Convert the Data:</b>
		<p>The software assumes that all of the files with the file name matching <code>upa*</code> are to be converted.  It will ignore all other files in the directory.  The data that is to be converted should be in the <b>raw_data</b> directory from the previous step.</p>
		<p>In the software directory is a script called <b>convert_pacs-gts</b>.  This script calls the <b>pacs-gts_converter</b> on all of the files in the <b>raw_data</b> directory.  It needs to be run from the <b>software</b> directory.  It is run by:</p>
		<p class="code">./convert_pacs-gts</p>
		</li>
		
	<li><b>QC the Data:</b>
		<p>In the software directory is a script called <b>autoqc.pl</b>.  This script calls the autoqc binary from the <b>autoqc</b> directory on all of the files in the <b>output</b> directory.  It places the output in the <b>final</b> directory and moves all of the error log files into the <b>err_logs</b> file.  It is run by:</p>
		<p class="code">./autoqc</p>
		<p>For more information on the auto qc, see: <a href="/dpg/GENERAL/soundings/howto_autoqc_class_soundings.html">How To: Auto QC CLASS Soundings</a>.</p>
		</li>
		
	<li><b>Ebufr the Data:</b>
		<p>In the software directory is a script called <b>create_ebufr_files.pl</b>.  This script calls the class2ebufr binary from the <b>ebufr</b> directory on all of the files in the <b>final</b> directory.  It places the EBUFR files in year directories in the <b>ebufr</b> directory.  It si run by:</p>
		<p class="code">./create_ebufr_files.pl</p>
		<p>This requires all of the EBUFR files to be in the <b>ebufr</b> directory.  More information on the EBUFR process can be found in <a href="/dpg/GENERAL/soundings/howto_ebufr_class_soundings.html">How To: EBUFR CLASS Soundings</a>.<p>
		</li>
		
	<li><b>Put the EBUFR files in CODIAC:</b>
		<p>The first part of putting the files in CODIAC is to copy the EBUFR files into the archive directory.  The archive directory is divided by year to make the files easier to find.</p>
		<P>The second part is editting and running the <b>insert_physdir.pl</b> script.  There are two parts of the file that need to be editted.<ol>
			<li>Edit the output file name.  This should be changed to keep a record of what was inserted into the database.  The path is set up to put the file in the <b>codiac</b> directory which is designed to store them.</li>
			<li>Edit the start directory.  This needs to be changed to find the new files.  (This may also require the file_match variable to be changed so it only pulls out the correct files.)</li>
			</ol>
		<p>This step may be run multiple times to handle files in different directories.</p>
		<p>The final part is putting the data into the database.  Login as <b>stormmnt</b> and insert start up empsql after changing to the <b>../codiac_db</b> directory.  Once the database is started run the command:</p>
		<p class="code">insert into on_line_phys_dir from '<full path file name>';</p>
		<p>This needs to be run as many times as files that were created when running the <b>insert_physdir.pl</b> script.</p>
		</li>
		
	<li><b>Archive the Data:</b>
		<p>This is the same step 1.  It is best to do it at the end so it is not forgotten the next time the data is processed.</p>
		</li>
</ol>

<hr>
<a name="software"></a>
<h2>Software</h2>
<p>This is a list of the software that is used for converting the PACS GTS data.</p>
<ul>
	<li>Makefile- The make commands for creating the <b>readupa</b> executable.</li>
	<li><a href="/cgi-bin/dpg/doc/docperl.cgi?file=/work/PACS/SOUNDING/GTS/software/archive.pl">archive.pl</a>- The script that moves the processed data to the archvie directory and gzips the files.</li>
	<li><a href="/cgi-bin/dpg/doc/docperl.cgi?file=/work/PACS/SOUNDING/GTS/software/autoqc.pl">autoqc.pl</a>- The script that runs the auto qc on the CLASS files.</li>
	<li>class2ebufr- A symbolic link to the binary that converts CLASS files to EBUFR.</li>
	<li><a href="../software/class_file">class_file</a>- A file needed by <b>class2ebufr</b> to run correctly.  This should not be changed.</li>
	<li><a href="../software/code_08_021">code_08_021</a>- A file needed by <b>class2ebufr</b> to run correctly.  This should not be changed.</li>
	<li><a href="../software/code_33_254">code_33_254</a>- A file needed by <b>class2ebufr</b> to run correctly.  This should not be changed.</li>
	<li><a href="../software/control_scf.txt">control_scf.txt</a>- A file needed by <b>class2ebufr</b> to run correctly.  This should only be changed if the project information needs to be changed.</li>
	<li><a href="../software/convert_pacs-gts">convert_pacs-gts</a>- The script that runs the conversion of the raw data into CLASS formatted data.</li>
	<li><a href="/cgi-bin/dpg/doc/docperl.cgi?file=/work/PACS/SOUNDING/GTS/software/create_ebufr_files.pl">create_ebufr_files.pl</a>- The script that converts the auto qc'ed data into EBUFR day files.</li>
	<li><a href="../software/desc_file">desc_file</a>- A file needed by <b>class2ebufr</b> to run correctly.  This should not be changed.</li>
	<li><a href="../software/insert_physdir.pl">insert_physdir.pl</a>- The script that creates output files for entering the EBUFR files into the database.</li>
	<li><a href="/cgi-bin/dpg/doc/docperl.cgi?file=/work/PACS/SOUNDING/GTS/software/pacs-gts_converter.pl">pacs-gts_converter.pl</a>- The script that converts raw data files into CLASS files.</li>
	<li>readupa- The executable that is created to convert the original raw data into the raw data that can be used by the conversion software.</li>
	<li>readupa.f- The source file for the <b>readupa</b> executable.</li>
</ul>
<p class="note">There is an older version of the software in the <b>archive</b> directory.  This remains in case it would become necessary to see what was done in the past.  It is only noted here as information to refer to.  It should not be run and will not work with the scripts that have just been listed.</p>

<hr>
<a name="docs"></a>
<h2>Documentation</h2>
<p>This is a list of docuementation for the PACS GTS sounding data.</p>
<ul>
	<li><a href="/dpg/GENERAL/soundings/howto_autoqc_class_soundings.html">How To: Auto QC CLASS Soundings</a>- The instructions on how to Auto QC sounding data in the CLASS format.</li>
	<li><a href="/dpg/GENERAL/soundings/howto_ebufr_class_soundings.html">How To: EBUFR CLASS Soundings</a>- The instructions on how to EBUFR sounding data in the CLASS format.</li>
	<li><a href="#">How To: PACS-GTS Soundings</a>- The instructions on how to process the PACS GTS data.  (This document.)</li>
	<li><a href="UPPERAIR.TXT">UPPERAIR.TXT</a>- The list of station information used in the converting of the raw data into CLASS format.</li>
</ul>

<hr>
<p class="foot">Last Updated: 2005/02/04 - Joel Clawson</p>
</body>
</html>
