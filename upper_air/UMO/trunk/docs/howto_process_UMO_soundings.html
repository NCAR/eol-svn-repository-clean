<html>
<head>
<title>How To: Process UMO Sounding Data</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="http://dmg.eol.ucar.edu/css/howto.css">
</head>

<body>
<h1 class="title">How To: Process University of Missouri (UMO) Upper Air Sounding Data</h1>
<a name="toc"></a><h2>Table of Contents</h2>
<div id="toc">
    <ol>
        <li><a href="#purpose">Purpose</a></li>
	<li><a href="#network">Network Information</a></li>
	<li>Previous Versions<ol>
                <li><a href="#version:plows20092010">2009-2010 (PLOWS)</a></li>
                <li><a href="#version:plows20082009">2008-2009 (PLOWS)</a> - first created.</li>
		</ol></li>
	<li><a href="directory">Directory Structure</a></li>
	<li>Processing the Data<ol>
	        <li><a href="#proc_setup">Initial Processing Setup</a></li>
                <li><a href="#convert_UMO">Converting the UMO Data</a></li>
		<li><a href="#autoqc">Auto QC</a></li>
                <li><a href="#visual_qc">Visual QC</a></li>
                <li><a href="#finalize">Finalization</a></li>
	        </ol></li>
        <li>Building Libraries and Executables<ol>
		<li><a href="#programs">Creating the Conversion Programs</a></li>
		</ol></li>
	<li><a href="#documents">Documentation</a></li>
    </ol>
</div>
<a href="#">Top</a><hr />

<a name="purpose"></a><h2>Purpose</h2>
<div class="block">
	<p>This document contains the process of how to convert the University of
	Missouri (UMO) upper air sounding data into the EOL Sounding Composite
	(ESC) format.</p>
</div>
<a href="#">Top</a><hr />

<a name="network"></a><h2>Network Information</h2>
<div class="block">
    <ul>
		<li>The Platform is 99 for Unknown. None were selected or set at this
		time in the CODIAC DB.</li>
        <li>The soundings are recorded in UTC.</li>
    </ul>
</div>
<a href="#">Top</a><hr />

<a name="version"></a><h2>Previous Versions</h2>
<div class="block">

    <a name="version:plows20092010"></a><h3>PLOWS (2009-2010)</h3>
    <table class="version">
        <tr><th>Software:</th><td><a href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FUMO%2F#_conversions_upper_air_UMO_">http://svn.eol.ucar.edu/svn/dmg/upper_air/UMO/tags/PLOWS_2009_2010</a>
        <tr><th>Raw Data:</th><td>/net/work/Projects/PLOWS/upper_air/UMO/2009-2010/process/raw_data</td></tr>
        <tr><th>Final Data:</th><td>/net/work/Projects/PLOWS/upper_air/UMO/2009-2010/process/database</td></tr>
		</table>

    <a name="version:plows20082009"></a><h3>PLOWS (2008-2009)</h3>
    <table class="version">
        <tr><th>Software:</th><td><a href="http://svn.eol.ucar.edu/websvn/listing.php?repname=dmg&path=%2Fconversions%2Fupper_air%2FUMO%2F#_conversions_upper_air_UMO_">http://svn.eol.ucar.edu/svn/dmg/upper_air/UMO/tags/PLOWS_2008_2009</a>
        <tr><th>Raw Data:</th><td>/net/work/Projects/PLOWS/upper_air/UMO/raw*</td></tr>
        <tr><th>Final Data:</th><td>/net/work/Projects/PLOWS/upper_air/UMO/process_10sec_data/database</td></tr>
    </table>
</div>

<a href="#">Top</a><hr />

<a name="directory"></a><h2>Directory Structure</h2>
<div class="block">
    <h3 class="directory_head">UMO/</h3>
    <table class="directories">
        <tr><th>5mb/</th><td>The directory where the extracted 5mb pressure sounding files are stored.</td></tr>
	<tr><th>build/</th><td>The auto-generated directory for the compiled Java classes.</td></tr>
        <tr><th>database/</th><td>The directory where the final processed data that will be put online is stored.</td></tr>
	<tr><th>docs/</th><td>The directory containing documentation about the processing and the data.</td></tr>
	<tr><th>final/</th><td>The directory where the auto QC'ed converted data files are placed.</td></tr>
        <tr><th>final_merged/</th><td>The directory where the best auto QC'ed files are placed in preparation for the visual QC.  The visual QC results are also placed in this directory.</td></tr>
	<tr><th>logs/</th><td>The directory where the error/check files from the QC are placed.</td></tr>
	<tr><th>output/</th><td>The directory where the processed MicroART files are put after they are formatted to ESC.</td></tr>
	<tr><th>raw_data/</th><td>The directory where the raw data is stored for the conversion.</td></tr>
	<tr><th>software/</th><td>The directory where the executable software for the conversion is stored.</td></tr>
        <tr><th>src/</th><td>The directory where the Java source files for the conversion are stored. Note that this actual conversion only requires Perl. The autoqc, dayfile creation, etc. do required Java. </td></tr>
    </table>
</div>
<a href="#">Top</a><hr />

<h2>Processing the Data</h2>
<div class="block">

<a name="proc_setup"></a><h3>Initial Processing Setup</h3>
<div class="block">
	<p class="note">There is only one preparatory step required before
	processing the data.</p>
    <ol>
		<li><p>Copy the source/raw data files into the <span
		class="directoryName">raw_data</span> directory. <span
		class="beware">BEWARE:</span> The converter expects the raw data to
		have a ".PYS" extension.</p>
	    <p><i>For PLOWS 2009-2010:</i></p>
	    <ul>
			<li><p>The ".PYS" extension had to be added to many of the raw data
			files.</p></li>
        </ul>	   
	    </li>
    </ol>
</div>

<a name="convert_rrs"></a><h3>Convert the UMO Data</h3>
<div class="block">
	<p class="note">This step runs Perl code and should work on basically any
	machine. However, to run the autoQC and any other processing/data prep done
	by the build.xml (Ant) file, you must run on a machine with the proper
	Ant and Java setup, such as merlot.</p>
    <ol>
		<li><p>Change to the <span class="directoryName">/software</span> directory
		where the conversion s/w (UMO_SND_Converter.pl) is located.</p></li>
		<li><p>Edit the <span class="softwareName">UMO_SND_Converter.pl</span>
		script. Update the "getProjectName" function in UMO_SND_Converter.pl to
		be the name of the current project.</p>
 		    <p><i>For PLOWS 2009-2010:</i></p>
	        <ul>		
				<li><p>Because there were issues with the release location
				data, the science staff (Scot) provided higher resolution
				latitude, longitude, and altitude values to be used.  Code was
				added to substitute in these new values.</p></li>	
	         </ul>
	        </li>
		<li><p>This step will convert all the *PYS* raw data files located in
		the <span class="directoryName">/raw_data</span> directory and place the
		output into the <span class="directoryName">/output</span> directory.
		The run.log file will contain informational messages generated during
		the conversion regarding the files converted. <i> Examine the contents
		of the run.log file carefully.</i></p>
        <p>In the software directory, execute the following command:</p>
        <p class="code">UMO_SND_Converter.pl >& run.log &</p>
        </li>
    </ol>
</div>

<a name="autoqc"></a><h3>Auto QC</h3>
<div class="block">
	<p class="note">This step works best on merlot, but can be done on any
	machine with the proper Ant and Java setup.</p>
	<p>These steps execute the automatic QC on the processed files (in <span
	class="directoryName">/output</span>), generates log files (in <span
	class="directoryName">/logs</span>), and places the QC'ed data files into a
	separate directory (<span class="directoryName">/final</span>) specified by
	the build.xml file.  After the QC processing has completed, the <span
	class="softwareName">ant autoqc</span> command runs the format checker on
	the QC'ed files. Here are the steps to run the sounding Automatic Quality
	Control Processing:</p>
    <ol>
	   <li><p>Stay in/Change to the top level processing directory where the Ant
	   <span class="softwareName">build.xml</span> file is located.</p></li>
	   <li><p>Check the <span class="softwareName">build.xml</span> file for the
	       <code>autoqc</code> target and make sure there is a/are:</p>
           <ol>
			   <li><p>A command to copy the properties file to the build
			   directory. There's typically a copy of the autoqc properties in
			   the software directory names something like
			   "us_plains_autoqc.properties".</p></li> 
			   <li><p>The java command(s) will be executed on the expected data in
			   the expected locations (i.e., ensure that the directory names in
			   the build.xml file are correct and what you want.)</p></li>
			   <li><p>and that you have updated the project name in the build.xml,
			   if included in the build.xml file.</p></li> 
           </ol></li>
       <li><p>Perform the auto QC by executing the ant command:</p>
           <p class="code">ant autoqc</p>
       </li>
    </ol>
</div>

<a name="visual_qc"></a><h3>Visual QC</h3>
<div class="block">
	<p>Once the auto QC is completed, email the scientific staff (i.e., Scot
	Loehrer) so that they can perform a visual QC on the data and give final
	approval of the processed data set, as required. Note that the visual qc is
	not performed on all sounding datasets.</p>
</div>

<a name="finalize"></a><h3>Finalization</h3>
<div class="block">
<p>After the visual QC is completed, the data set is ready to be finalized
(i.e, prep'd for CODIAC).</p>  
    <ol>
		<li><p> Update this "How To" document to indicate the latest project
		this conversion was executed for and include any notes about upgrades
		made specifically for that project, as required. A copy of this
		document is generally found in the <span
		class="directoryName">/docs</span> directory. Place a copy of the
		updated doc in <span
		class="directoryName">/net/web/dmg/html/software/conversions/upper_air/UMO
		</span> directory. The s/w repository page points to this doc in that
		web location, so this must be updated.  The s/w repository page is
		located <a
		href="http://www.eol.ucar.edu/about/our-organization/cds/dmg/dmg-internal/dmg-documentation/encyclopedia/repository-dmg-subversion-listing"
		target='_top'><b>here</b></a>. </p></li>

		<li><p>Update the dataset description (or EMDAC) document for this
		conversion. Work with the scientific staff to create an EMDAC document.
		Generally, start with an existing "similar" document and simply update
		it for this project and dataset.  Generally, a copy of the EMDAC doc
		can be found in the <span class="directoryName">/docs</span>
		area.</p></li>

		<li><p>The next processing step is to create day files that can/will be
		loaded into the EMDAC/CODIAC database, along with the EMDAC dataset
		description document.  The dayfiles creation step will generate day
		files sorted by nominal release date followed by station location as
		required by CODIAC. It's very important that the output dayfiles be in
		this expected sort order so that CODIAC can access all the soundings
		within a single dayfile. Do the following steps to create the day
		files.</p>
        <ol>
			<li><p>Ensure that you are in the same (top) directory as the
			build.xml file. Create the day files using the ant command:</p>
                <p class="code">ant dayfiles</p>
				<p>This will create a file for each day where at least one
				sounding exists in the <span
				class="directoryName">database</span> directory or whichever
				directory is specified as the output directory in the build.xml
				file. If this dataset is to be put online "as is", these ar the
				dayfiles to load into CODIAC.</p>
            </li>
        </ol>
    </ol>
</div>

<a name="5mb-extract"></a><h3>5mb Extraction</h3>
<div class="block">
	<p>If the converted soundings are also going to be placed into a 5mb
	composite, the soundings need to have the proper 5mb pressure level
	soundings generated.  This is done through the following steps:</p>
    <ol>
        <li><p>Generate the 5mb pressure level data files using the ant command:</p>
            <p class="code">ant 5mb-extract</p>
			<p>This will generate a 5 mb sounding file for each sounding in the
			<span class="directoryName">final_merged</span> directory and place
			it in the <span class="directoryName">5mb</span>.  It will also run
			some final checks to make sure the format is correct. Beware that
			the file directories listed in the build.xml file are what you
			expect and want.</p>
        </li>
    </ol>
	<p>The generated 5mb data files will then be available when the composite
	is generated.</p>
</div>

<a href="#">Top</a><hr />


<h2>Building Libraries and Executables</h2>
<a name="mat_library"></a><h3>Creating the Matrix Library</h3>
<div class="block">
	<p class="note"> No stand alone libraries are required to be rebuilt to run
	this processing. </p>
</div>

<p><a href="#">Top</a></p><hr />

<a name="documents"></a><h2>Documentation</h2>
<div class="block">
	<p>The following are a list of documents that may help with the conversion
	or are related to the raw data.</p>
    <ul>
	<li><a href="/software/tools/upper_air/autoqc">How To: AUTO QC Sounding
	Data</a>- The instructions for dealing with the AUTO QC program.</li>
	<li><a href="/software/tools/upper_air/esc_format_checker">How To: ESC
	Format Checker</a>- The instructions and API for working with the ESC
	format checker program.</li>
	<li><a href="/software/tools/upper_air/esc_record_sorter">How To: ESC
	Record Sorter</a>- The instructions and API for working with the ESC record
	sorter program.</li>
	<li><a href="#">How To: Process UMO Sounding Data</a>- This document.</li>
    </ul>
</div>
<a href="#">Top</a><hr>

<p class="foot">Last Updated: 2010/04/02 - Linda Echo-Hawk</p>
</body>
</html>
